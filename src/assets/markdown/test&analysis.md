### 3.1 测试方案

&ensp;&ensp;&ensp;&ensp;由于两个模型在一定程度上是独立的，所以可以对两个模型分别进行测试。

#### 3.1.1 DenseNet网络模型

- a) 准备数据，使用第二章中所分割出的 25%数据集作为输入
- b) 调用模型，调用训练好的模型。
- c) 输出 label，并与与本身 label 进行对比。
- d) 对结果进行分析。

#### 3.1.2 Kmeans聚类模型

- a) 准备数据。
- b) 检验 Kmeans 算法对私有协议网络流量的聚类效果以及影响因素;
- c) 对聚类效果进行分析，并给出合理的改进方案。

### 3.2 测试环境

#### 3.2.1 软件环境

| 指标  | 参数                       |
| ----- | -------------------------- |
| OS    | Ubuntu 18.04.3 LTS         |
| Type  | 64-bit Operating System    |
| Tools | JetBrains PyCharm Edu 2019 |

### 3.2.2 硬件环境

| 指标   | 参数                |
| ------ | ------------------- |
| CPU    | Intel i5-7300HQ     |
| NVIDIA | NVIDIA Geforce 950M |
| MEMORY | 8G                  |

#### 3.2.3 相关语言及库

| 指标     | 参数                            |
| -------- | ------------------------------- |
| Language | Python 3.7                      |
| Lib      | Pytorch， sklearn， pandas， numpy |

### 3.3 详细测试

#### 3.3.1 DenseNet网络模型

(1) 数据准备
| 编号 | 协议名称 | 测试集 |
| ---- | -------- | ------ |
| 0    | TCP      | 1750   |
| 1    | UDP      | 1750   |
| 2    | DNS      | 1750   |
| 3    | SMB      | 1750   |
| 4    | MDNS     | 1750   |
| 5    | SSH      | 1750   |
| 6    | VNC      | 1750   |
| 7    | STUN     | 1750   |
| 8    | HTTP     | 1750   |
| 9    | NBNS     | 1750   |

(2) 操作步骤

- 1、首先进行数据处理，我们取 9 种类型各 700 个，共计 6300 个样例进行验证;
- 2、对 9 种数据进行归类，分为 9 个文件;
- 3、各自输入 CNN 进行验证，并将结果保存在文件中;
- 4、对结果进行对比，并计算准确率;
- 5、统计并制作表格。

(3) 结果分析

| 协议 | 准确率 |
| ---- | ------ |
| TCP  | 0.8829 |
| UDP  | 1.0000 |
| DNS  | 0.9857 |
| SMB  | 1.0000 |
| MDNS | 1.0000 |
| SSH  | 0.9786 |
| VNC  | 0.9757 |
| STUN | 0.9971 |
| HTTP | 0.8857 |
| NBNS | 0.9986 |

&ensp;&ensp;&ensp;&ensp;我们对 9 种类型，每个类型 700 个，共计 6300 个通过 CNN 模型进行验证，其中
7 中正确率较高，准确率较低的为 TCP 和 HTTP，但实际上 HTTP 和 TCP 可以通过其固定格式进行识别验证，例如 HTTP 的 Request URL，Request Method 等。后续可以着重这几点进行改进。其他类型准确率均较高。

#### 3.3.2 Kmeans 聚类模型

(1) 数据准备

&ensp;&ensp;&ensp;&ensp;基于前述，使用数据集中的部分协议作为私有协议网络流进行测试，随机从中选择两种模拟私有协议分别取出 200 组数据，构成数据集表-12:

![aZwv7T.png](https://s1.ax1x.com/2020/07/29/aZwv7T.png)

(2) 检验 Kmeans 算法对私有协议网络流量的聚类效果以及影响因素

&ensp;&ensp;&ensp;&ensp;鉴于可视化的结果，可以合理推测出算法识别的错误率会随着输入私有协议网络流量协议种类增加而提高。

&ensp;&ensp;&ensp;&ensp;下面分别将 K 值设置为 2/4，对上述数据集进行聚类，结果如表-13、表-14 所示

![aZ06ET.png](https://s1.ax1x.com/2020/07/29/aZ06ET.png)

![aZDh0x.png](https://s1.ax1x.com/2020/07/29/aZDh0x.png)

&ensp;&ensp;&ensp;&ensp;可以看出，当输入网络数据集只有两种协议时，大多数组别可以达到很好的聚类效果;当输入网络数据集变为四种协议时，各类协议网络流都出现了不同程度的相互渗透，多数每一个归类下有 2 到 3 种协议的网络流量，Kmeans 的聚类效果也出现了衰减。

(3) 改进后的 Kmeans

&ensp;&ensp;&ensp;&ensp;正如前述理论所言，使用密度来划分聚类中心以及区别孤立点以此来优化聚类效果，该算法介绍已经在第二章提到，这里不加赘述。

&ensp;&ensp;&ensp;&ensp;为了更加合理的判断中心点和孤立点，这里设置两个参数α，β，一组数据的密度大于数据集密度标准差的一定比例时， 该组数据可认为是疑似中心点，这里比例参数也就是α:

![aZsCa6.png](https://s1.ax1x.com/2020/07/29/aZsCa6.png)

&ensp;&ensp;&ensp;&ensp;当一组数据的密度小于整个数据集的密度标准差一定比例时，该组数据可认为是孤立点，这里的比例就是β:

![aZskGD.png](https://s1.ax1x.com/2020/07/29/aZskGD.png)

&ensp;&ensp;&ensp;&ensp;为了确定合理的α、β参数，采用控制变量法进行实验，将α、β初始值设置为
1，随后保持一个进行调整，效果如下:

![aZsad0.png](https://s1.ax1x.com/2020/07/29/aZsad0.png)

&ensp;&ensp;&ensp;&ensp;通过模拟实验来证明基于改进 Kmeans 算法的未知协议之私有协议识别算法在一定条件下能够对私有协议流量完成分类，通过模拟实验验证了影响算法识别效果最大因素是输入数据集中私有协议类型数量。接着对提出的算法改进方案进行实验设计和验证，证明了合理调整参数α和β可以提高本算法对数据中心点和孤立点的判断准确性。
